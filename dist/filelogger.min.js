/*!
 * fileLogger
 * Copyright 2016 Peter Bakondy https://github.com/pbakondy
 * See LICENSE in this repository for license information
 */
!function(){!function(){angular.module("fileLogger",["ngCordova.plugins.file"]).factory("$fileLogger",["$q","$window","$cordovaFile","$timeout","$filter",function(e,o,n,r,t){"use strict";function l(){return o.parent&&o.parent.ripple}function a(){return!o.cordova&&!o.PhoneGap&&!o.phonegap||l()}function i(e){angular.isString(e)?(e=e.toUpperCase(),R.indexOf(e)===-1&&(e="INFO")):e="INFO";for(var o,n=new Date,r=b?t("date")(n,b,S):n.toJSON(),l=Array.prototype.slice.call(arguments,1),a=[r,e],i=0;i<l.length;i++)if(angular.isArray(l[i])){o="[Array]";try{o=JSON.stringify(l[i])}catch(s){}a.push(o)}else if(angular.isObject(l[i])){o="[Object]";try{o=JSON.stringify(l[i])}catch(s){}a.push(o)}else a.push(l[i]);if(l.unshift(r),angular.isObject(console)&&angular.isFunction(console.log))switch(e){case"DEBUG":angular.isFunction(console.debug)?console.debug.apply(console,l):console.log.apply(console,l);break;case"INFO":angular.isFunction(console.debug)?console.info.apply(console,l):console.log.apply(console,l);break;case"WARN":angular.isFunction(console.debug)?console.warn.apply(console,l):console.log.apply(console,l);break;case"ERROR":angular.isFunction(console.debug)?console.error.apply(console,l):console.log.apply(console,l);break;default:console.log.apply(console,l)}O.push({message:a.join(" ")+"\n"}),j||c()}function c(){if(!O.length)return void(j=!1);j=!0;var e=O.shift();s(e.message).then(function(){r(function(){c()})},function(){r(function(){c()})})}function s(r){var t=e.defer();if(a())o.localStorage[w]||(o.localStorage[w]=""),o.localStorage[w]+=r,t.resolve();else{if(!o.cordova||!o.cordova.file||!N())return t.reject('storageFolder "'+N()+'" is not available'),t.promise;n.checkFile(N(),w).then(function(){n.writeExistingFile(N(),w,r).then(function(){t.resolve()},function(e){t.reject(e)})},function(){n.writeFile(N(),w,r,!0).then(function(){t.resolve()},function(e){t.reject(e)})})}return t.promise}function u(){var r=e.defer();if(a())r.resolve(o.localStorage[w]);else{if(!o.cordova||!o.cordova.file||!N())return r.reject('storageFolder "'+N()+'" is not available'),r.promise;n.readAsText(N(),w).then(function(e){r.resolve(e)},function(e){r.reject(e)})}return r.promise}function f(){var r=e.defer();if(a())o.localStorage.removeItem(w),r.resolve();else{if(!o.cordova||!o.cordova.file||!N())return r.reject('storageFolder "'+N()+'" is not available'),r.promise;n.removeFile(N(),w).then(function(e){r.resolve(e)},function(e){r.reject(e)})}return r.promise}function g(e){return!!(angular.isString(e)&&e.length>0)&&(A=e,!0)}function p(e){return!!(angular.isString(e)&&e.length>0)&&(w=e,!0)}function d(e,o){if(!angular.isUndefined(e)&&!angular.isString(e))throw new TypeError("format parameter must be a string or undefined");if(!angular.isUndefined(o)&&!angular.isString(o))throw new TypeError("timezone parameter must be a string or undefined");b=e,S=o}function v(){var r=e.defer();if(a())r.resolve({name:w,localURL:"localStorage://localhost/"+w,type:"text/plain",size:o.localStorage[w]?o.localStorage[w].length:0});else{if(!o.cordova||!o.cordova.file||!N())return r.reject('storageFolder "'+N()+'" is not available'),r.promise;n.checkFile(N(),w).then(function(e){e.file(r.resolve,r.reject)},r.reject)}return r.promise}function y(){var e=Array.prototype.slice.call(arguments,0);e.unshift("DEBUG"),i.apply(void 0,e)}function h(){var e=Array.prototype.slice.call(arguments,0);e.unshift("INFO"),i.apply(void 0,e)}function m(){var e=Array.prototype.slice.call(arguments,0);e.unshift("WARN"),i.apply(void 0,e)}function F(){var e=Array.prototype.slice.call(arguments,0);e.unshift("ERROR"),i.apply(void 0,e)}var b,S,O=[],j=!1,R=["DEBUG","INFO","WARN","ERROR"],w="messages.log",A=null,N=function(){return A?A:cordova.file?cordova.file.externalDataDirectory:null};return{log:i,getLogfile:u,deleteLogfile:f,setStorageFoldername:g,setStorageFilename:p,setTimestampFormat:d,checkFile:v,debug:y,info:h,warn:m,error:F}}])}()}();